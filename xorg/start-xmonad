#!/bin/bash

function random_bg() {
    feh --no-fehbg --bg-fill --randomize /usr/share/dotfiles/backgrounds/*
}

function bg_daemon() {
    while :
    do
        random_bg
        sleep 900
    done
}

# ssh-agent
eval $(ssh-agent)
nm-applet &

# Set cursor
xset s offxsetroot -cursor_name left_ptr

# Set fonts, colors etc for urxvt
xrdb ~/.Xresources

# Monitor setup
case $(hostname) in
    Loke)
        # Disable bell
        xset -b

        case "$(xrandr --listmonitors | wc -l)" in
            2)
                # Set primary screen
                # Do we need to set a resolution?
                # xrandr --output eDP-1 --left-of DP-2
                ;;
            3)
                # Set primary screen
                xrandr --output DP-2 --primary
                xrandr --output eDP-1 --mode 1360x768 --pos 0x432
                ;;
            *)
                >2& echo "Unhandled number of displays!"
                exit 1
        esac
        ;;
    Fenrisulven)
        # Set primary screen
        xrandr --output DP-0 --primary
        xrandr --output DP-3 --left-of DP-0
        ;;
    *)
        echo "Skipping host specific initialization"
        ;;
esac

# Mouse settings
DEVICE_ID=`xinput list --id-only "pointer:ELECOM TrackBall Mouse HUGE TrackBall" 2> /dev/null`
if [ "$DEVICE_ID" != "" ]
then
    xinput --set-prop $DEVICE_ID "libinput Scroll Method Enabled" 0, 0, 1
    xinput --set-prop $DEVICE_ID "libinput Button Scrolling Button" 9
    xinput --set-button-map $DEVICE_ID 1 0 1 4 5 6 7 3 0 10 11 2
fi

# Set keyboard layout
setxkbmap "us(dvorak-intl)"

# Remap CapsLock->Escape
xmodmap -e 'clear Lock' -e 'keycode 0x42 = Escape'

# Enable numlock
numlockx on

# Start BG daemon
bg_daemon &

# Start dunst (show notifications)
dunst &

# Start composition manager, to allow transparency
xcompmgr &

# Start Conky
conky &

# Start WM
xmonad

exit 0
